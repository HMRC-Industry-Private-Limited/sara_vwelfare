<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <!-- Graph View for Statistics -->
  <record id="test_type_statistics_graph_view" model="ir.ui.view">
    <field name="name">test.type.statistics.graph</field>
    <field name="model">test.type.statistics</field>
    <field name="arch" type="xml">
      <graph string="Test Results Distribution" type="pie" sample="1">
        <field name="result_text" type="row" />
        <field name="test_id" type="col" />
        <field name="count" />
        <field name="percentage" type="measure" />
      </graph>
    </field>
  </record>

  <!-- Kanban View for Statistics -->
  <record id="test_type_statistics_kanban_view" model="ir.ui.view">
    <field name="name">test.type.statistics.kanban</field>
    <field name="model">test.type.statistics</field>
    <field name="arch" type="xml">
      <kanban class="o_kanban_dashboard" default_group_by="test_id">
        <field name="test_id" />
        <field name="result_text" />
        <field name="count" />
        <field name="percentage" />
        <field name="total_count" />
        <templates>
          <t t-name="kanban-box">
            <div class="oe_kanban_card oe_kanban_global_click">
              <div class="oe_kanban_details">
                <div class="o_kanban_record_top">
                  <div class="o_kanban_record_headings">
                    <strong class="o_kanban_record_title">
                      <field name="result_text" />
                    </strong>
                  </div>
                </div>
                <div class="o_kanban_record_bottom">
                  <div class="oe_kanban_bottom_left">
                    <span>
                      <t t-esc="record.count.value" />
                      /
                      <t t-esc="record.total_count.value" />
                    </span>
                  </div>
                  <div class="oe_kanban_bottom_right">
                    <field name="percentage" widget="progressbar" />
                    <span class="text-right"><field name="percentage" widget="float" options="{'digits':[0,2]}" />%
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </t>
        </templates>
      </kanban>
    </field>
  </record>

  <!-- Tree View for Statistics -->
  <record id="test_type_statistics_tree_view" model="ir.ui.view">
    <field name="name">test.type.statistics.tree</field>
    <field name="model">test.type.statistics</field>
    <field name="arch" type="xml">
      <tree string="Test Results Statistics">
        <field name="test_id" />
        <field name="result_text" />
        <field name="count" />
        <field name="total_count" />
        <field name="percentage" string="النسبة (%)" widget="float" options="{'digits':[0,2]}" />
        <!--         <field name="percentage" widget="progressbar" /> -->
      </tree>
    </field>
  </record>

  <!-- Search View for Statistics -->
  <record id="test_type_statistics_search_view" model="ir.ui.view">
    <field name="name">test.type.statistics.search</field>
    <field name="model">test.type.statistics</field>
    <field name="arch" type="xml">
      <search>
        <field name="test_id" />
        <field name="result_text" />
        <group expand="0" string="Group By">
          <filter string="Test" name="group_by_test" context="{'group_by':'test_id'}" />
          <filter string="Result Category" name="group_by_result_text" context="{'group_by':'result_text'}" />
        </group>
      </search>
    </field>
  </record>

  <!-- Pivot View for Test Statistics -->
  <record id="test_type_statistics_pivot_view" model="ir.ui.view">
    <field name="name">test.type.statistics.pivot</field>
    <field name="model">test.type.statistics</field>
    <field name="arch" type="xml">
      <pivot string="تحليل نتائج الاختبارات" sample="1">
        <!-- تجميع البيانات تمامًا كما في الكانبان -->
        <field name="test_id" type="col" />
        <field name="result_text" type="col" />
        <!-- استخدام نفس المقاييس من الكانبان -->
        <field name="count" type="measure" />
        <field name="percentage" type="measure" />
      </pivot>
    </field>
  </record>

  <!-- تعديل الإجراء ليظهر نفس البيانات بالضبط -->
  <record id="action_test_type_statistics" model="ir.actions.act_window">
    <field name="name">تحليل نتائج الاختبارات</field>
    <field name="res_model">test.type.statistics</field>
    <field name="view_mode">pivot,graph,kanban,tree</field>
    <field name="context">{
      'pivot_measures': ['count', 'percentage'],
      'pivot_column_groupby': ['test_id'],
      'pivot_row_groupby': ['result_text']
      }
    </field>
  </record>


</odoo>